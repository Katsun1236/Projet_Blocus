â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”¥ RÃˆGLES FIREBASE CORRIGÃ‰ES - Ã€ COPIER MAINTENANT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  LES ANCIENNES RÃˆGLES Ã‰TAIENT FAUSSES ! Utilise ces nouvelles rÃ¨gles.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1ï¸âƒ£  FIRESTORE DATABASE RULES (CORRIGÃ‰ES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Firebase Console â†’ Firestore Database â†’ RÃ¨gles
ğŸ“ REMPLACE TOUT par :

rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ============================================================================
    // COLLECTION: users
    // ============================================================================
    match /users/{userId} {
      // Lire/Ã©crire son propre document user
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Sous-collection: courses
      match /courses/{courseId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Sous-collection: planning (PAS events !)
      match /planning/{eventId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Sous-collection: syntheses (sous users)
      match /syntheses/{synthesisId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Sous-collection: notifications
      match /notifications/{notifId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Sous-collection: quizzes
      match /quizzes/{quizId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // ============================================================================
    // COLLECTION: community_posts (PAS community !)
    // ============================================================================
    match /community_posts/{postId} {
      // Tout le monde peut lire
      allow read: if request.auth != null;
      // CrÃ©er un post
      allow create: if request.auth != null;
      // Modifier/supprimer son propre post OU liker
      allow update: if request.auth != null &&
        (request.auth.uid == resource.data.userId ||
         request.auth.uid in get(/databases/$(database)/documents/community_posts/$(postId)).data.likes);
      allow delete: if request.auth != null && request.auth.uid == resource.data.userId;

      // Sous-collection: comments
      match /comments/{commentId} {
        allow read: if request.auth != null;
        allow create: if request.auth != null;
        allow update, delete: if request.auth != null && request.auth.uid == resource.data.userId;
      }
    }

    // ============================================================================
    // COLLECTION: groups
    // ============================================================================
    match /groups/{groupId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.creatorId;

      // Sous-collection: files
      match /files/{fileId} {
        allow read: if request.auth != null;
        allow write: if request.auth != null;
      }

      // Sous-collection: messages
      match /messages/{messageId} {
        allow read: if request.auth != null;
        allow write: if request.auth != null;
      }
    }

    // ============================================================================
    // COLLECTION ROOT: syntheses
    // ============================================================================
    match /syntheses/{synthesisId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == resource.data.userId;
    }

    // ============================================================================
    // COLLECTION ROOT: files
    // ============================================================================
    match /files/{fileId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == resource.data.userId;
    }

    // ============================================================================
    // COLLECTION ROOT: quiz_results
    // ============================================================================
    match /quiz_results/{resultId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == resource.data.userId;
    }

    // ============================================================================
    // Deny all par dÃ©faut
    // ============================================================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2ï¸âƒ£  STORAGE RULES (INCHANGÃ‰ES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Firebase Console â†’ Storage â†’ RÃ¨gles
ğŸ“ REMPLACE TOUT par :

rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    function isValidSize(maxSizeMB) {
      return request.resource.size < maxSizeMB * 1024 * 1024;
    }

    function isImage() {
      return request.resource.contentType.matches('image/.*');
    }

    function isPDF() {
      return request.resource.contentType == 'application/pdf';
    }

    function isDocument() {
      return isPDF() ||
             request.resource.contentType.matches('application/vnd.*') ||
             request.resource.contentType.matches('text/.*');
    }

    // Photos de profil
    match /avatars/{userId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId) && isImage() && isValidSize(5);
    }

    // Fichiers de cours
    match /courses/{userId}/{allPaths=**} {
      allow read: if isOwner(userId);
      allow write: if isOwner(userId) &&
        (isDocument() || isImage()) &&
        isValidSize(50);
    }

    // Fichiers communautaires
    match /community/{userId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId) && isImage() && isValidSize(10);
    }

    // Fichiers de synthÃ¨ses
    match /syntheses/{userId}/{fileName} {
      allow read: if isOwner(userId);
      allow write: if isOwner(userId) && isPDF() && isValidSize(20);
    }

    // PiÃ¨ces jointes de messages
    match /messages/{userId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId) &&
        (isImage() || isDocument()) &&
        isValidSize(10);
    }

    // Fichiers de groupes
    match /groups/{groupId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() &&
        (isImage() || isDocument()) &&
        isValidSize(20);
    }

    // Deny all par dÃ©faut
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âš ï¸  DIFFÃ‰RENCES CRITIQUES AVEC LES ANCIENNES RÃˆGLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ AVANT (FAUX) :
- match /events/{eventId}          â†’ âœ… MAINTENANT: match /planning/{eventId}
- match /community/{postId}         â†’ âœ… MAINTENANT: match /community_posts/{postId}
- Manquait: files (root)            â†’ âœ… AJOUTÃ‰
- Manquait: syntheses (root)        â†’ âœ… AJOUTÃ‰
- Manquait: quiz_results (root)     â†’ âœ… AJOUTÃ‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ INSTRUCTIONS - FAIS Ã‡A MAINTENANT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Va sur : https://console.firebase.google.com/project/projet-blocus-v2/firestore/rules
2. SUPPRIME TOUTES les anciennes rÃ¨gles
3. COPIE les nouvelles rÃ¨gles Firestore (1ï¸âƒ£) ci-dessus
4. COLLE dans l'Ã©diteur
5. Clique sur "PUBLIER"
6. Attends 30 secondes
7. Vide le cache (Ctrl+Shift+R)
8. TESTE â†’ Toutes les erreurs "Missing permissions" doivent disparaÃ®tre !

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
