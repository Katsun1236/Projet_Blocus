â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RÃˆGLES FIREBASE Ã€ COPIER DANS LA CONSOLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  IMPORTANT : Copie ces rÃ¨gles EXACTEMENT dans la console Firebase
    https://console.firebase.google.com/project/projet-blocus-v2

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1ï¸âƒ£  FIRESTORE DATABASE RULES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ OÃ¹ ? Firebase Console â†’ Firestore Database â†’ RÃ¨gles
ğŸ“ Action : REMPLACE TOUT le contenu par ce qui suit â†“

rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Fonctions helper
    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    function isSameUser(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    // Collection users
    match /users/{userId} {
      // L'utilisateur peut lire et Ã©crire ses propres donnÃ©es
      allow read, write: if isSameUser(userId);

      // Sous-collections de l'utilisateur
      match /courses/{courseId} {
        allow read, write: if isOwner(userId);
      }

      match /syntheses/{synthesisId} {
        allow read, write: if isOwner(userId);
      }

      match /quizzes/{quizId} {
        allow read, write: if isOwner(userId);
      }

      match /flashcard_decks/{deckId} {
        allow read, write: if isOwner(userId);

        match /cards/{cardId} {
          allow read, write: if isOwner(userId);
        }
      }

      match /events/{eventId} {
        allow read, write: if isOwner(userId);
      }

      match /notifications/{notifId} {
        allow read, write: if isOwner(userId);
      }

      match /folders/{folderId} {
        allow read, write: if isOwner(userId);
      }

      match /files/{fileId} {
        allow read, write: if isOwner(userId);
      }
    }

    // Collection community (posts publics)
    match /community/{postId} {
      // Tout le monde authentifiÃ© peut lire
      allow read: if isAuthenticated();
      // Seul le crÃ©ateur peut Ã©crire/modifier
      allow create: if isAuthenticated();
      allow update, delete: if isAuthenticated() &&
        (request.auth.uid == resource.data.userId ||
         request.auth.uid in resource.data.likes);

      // Commentaires des posts
      match /comments/{commentId} {
        allow read: if isAuthenticated();
        allow create: if isAuthenticated();
        allow update, delete: if isAuthenticated() &&
          request.auth.uid == resource.data.userId;
      }
    }

    // Collection groups
    match /groups/{groupId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update, delete: if isAuthenticated() &&
        request.auth.uid == resource.data.creatorId;

      match /members/{memberId} {
        allow read: if isAuthenticated();
        allow write: if isAuthenticated();
      }

      match /posts/{postId} {
        allow read: if isAuthenticated();
        allow create: if isAuthenticated();
        allow update, delete: if isAuthenticated() &&
          request.auth.uid == resource.data.userId;
      }
    }

    // Collection forum
    match /forum/{threadId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update, delete: if isAuthenticated() &&
        request.auth.uid == resource.data.userId;

      match /replies/{replyId} {
        allow read: if isAuthenticated();
        allow create: if isAuthenticated();
        allow update, delete: if isAuthenticated() &&
          request.auth.uid == resource.data.userId;
      }
    }

    // Collection friendships
    match /friendships/{friendshipId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update, delete: if isAuthenticated() &&
        (request.auth.uid == resource.data.user1 ||
         request.auth.uid == resource.data.user2);
    }

    // Collection messages (chat)
    match /messages/{messageId} {
      allow read: if isAuthenticated() &&
        (request.auth.uid == resource.data.senderId ||
         request.auth.uid == resource.data.receiverId);
      allow create: if isAuthenticated();
      allow update, delete: if isAuthenticated() &&
        request.auth.uid == resource.data.senderId;
    }

    // Collection analytics (optionnel)
    match /analytics/{analyticsId} {
      allow read, write: if isAuthenticated();
    }

    // Deny all par dÃ©faut
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2ï¸âƒ£  FIREBASE STORAGE RULES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ OÃ¹ ? Firebase Console â†’ Storage â†’ RÃ¨gles
ğŸ“ Action : REMPLACE TOUT le contenu par ce qui suit â†“

rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Fonction helper
    function isAuthenticated() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    // Fonction pour valider la taille des fichiers
    function isValidSize(maxSizeMB) {
      return request.resource.size < maxSizeMB * 1024 * 1024;
    }

    // Fonction pour valider le type de fichier
    function isImage() {
      return request.resource.contentType.matches('image/.*');
    }

    function isPDF() {
      return request.resource.contentType == 'application/pdf';
    }

    function isDocument() {
      return isPDF() ||
             request.resource.contentType.matches('application/vnd.*') ||
             request.resource.contentType.matches('text/.*');
    }

    // Photos de profil
    match /avatars/{userId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId) && isImage() && isValidSize(5);
    }

    // Fichiers de cours
    match /courses/{userId}/{allPaths=**} {
      allow read: if isOwner(userId);
      allow write: if isOwner(userId) &&
        (isDocument() || isImage()) &&
        isValidSize(50);
    }

    // Fichiers communautaires (images de posts, etc.)
    match /community/{userId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId) && isImage() && isValidSize(10);
    }

    // Fichiers de synthÃ¨ses gÃ©nÃ©rÃ©es
    match /syntheses/{userId}/{fileName} {
      allow read: if isOwner(userId);
      allow write: if isOwner(userId) && isPDF() && isValidSize(20);
    }

    // PiÃ¨ces jointes de messages
    match /messages/{userId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isOwner(userId) &&
        (isImage() || isDocument()) &&
        isValidSize(10);
    }

    // Fichiers de groupes
    match /groups/{groupId}/{fileName} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() &&
        (isImage() || isDocument()) &&
        isValidSize(20);
    }

    // Deny all par dÃ©faut
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3ï¸âƒ£  INDICES FIRESTORE (Optionnels mais recommandÃ©s)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ OÃ¹ ? Les crÃ©er depuis la console lorsque tu vois une erreur "index required"
      OU crÃ©er manuellement : Firestore Database â†’ Index â†’ CrÃ©er un index

ğŸ“ Indices Ã  crÃ©er :

1. Collection: users/{userId}/courses
   Champs: createdAt (Descendant)

2. Collection: users/{userId}/quizzes
   Champs: createdAt (Descendant)

3. Collection: users/{userId}/syntheses
   Champs: createdAt (Descendant)

4. Collection: community
   Champs: createdAt (Descendant), likes (Descendant)

5. Collection: users/{userId}/events
   Champs: start (Ascendant)

6. Collection: forum
   Champs: createdAt (Descendant), replies (Descendant)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ… CHECKLIST APRÃˆS CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[ ] 1. Copier les rÃ¨gles Firestore dans Firebase Console
[ ] 2. Cliquer sur "Publier" dans l'Ã©diteur de rÃ¨gles Firestore
[ ] 3. Copier les rÃ¨gles Storage dans Firebase Console
[ ] 4. Cliquer sur "Publier" dans l'Ã©diteur de rÃ¨gles Storage
[ ] 5. Attendre 30 secondes pour la propagation
[ ] 6. Vider le cache du navigateur (Ctrl+Shift+R)
[ ] 7. Tester le site - plus d'erreurs "Missing permissions" !

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”— LIENS UTILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Console Firebase : https://console.firebase.google.com/project/projet-blocus-v2
Firestore Rules   : https://console.firebase.google.com/project/projet-blocus-v2/firestore/rules
Storage Rules     : https://console.firebase.google.com/project/projet-blocus-v2/storage/rules

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
